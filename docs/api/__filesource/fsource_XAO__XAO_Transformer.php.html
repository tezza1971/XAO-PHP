<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>File Source for XAO_Transformer.php</title>
	<link rel="stylesheet" type="text/css" href="../media/style.css">
	<meta http-equiv='Content-Type' content='text/html; charset=iso-8859-1'/>
</head>
<body>

<table border="0" cellspacing="0" cellpadding="0" height="48" width="100%">
  <tr>
	<td class="header-top-left">
        Documentation automatically generated from the source-code
        using <a href="http://phpdocu.sourceforge.net/" title="Go to the phpDocumentor homepage.">phpDocumentor</a>.
       <div>Official Homepage: <a href="https://github.com/tezza1971/XAO-PHP>github.com/tezza1971/XAO-PHP</a></div>
    </td>
    <td class="header-top-right">XAO<div class="header-top-right-subpackage"></div></td>
  </tr>
  <tr><td colspan="2" class="header-line"><img src="../media/empty.png" width="1" height="1" border="0" alt=""  /></td></tr>
  <tr>
    <td colspan="2" class="header-menu">
          <a href="https://github.com/tezza1971/XAO-PHP>Official homepage</a> |
          <a href="../index.html">API home</a> |
  		  <a href="../classtrees_XAO.html" class="menu">class tree: XAO</a> |
		  <a href="../elementindex_XAO.html" class="menu">index: XAO</a> |
		  <a href="../elementindex.html" class="menu">all elements</a>
    </td>
  </tr>
  <tr><td colspan="2" class="header-line"><img src="../media/empty.png" width="1" height="1" border="0" alt=""  /></td></tr>
</table>

<table width="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="195" class="menu">
		<div class="package-title">XAO</div>
      <b>Packages:</b><br />
  <div class="package">
              <a href="../li_XAO.html">XAO</a><br />
      	</div>
      <br />
                
                                <br />
                    </td>
    <td>
      <table cellpadding="10" cellspacing="0" width="100%" border="0"><tr><td valign="top">

<h1 align="center">Source for file XAO_Transformer.php</h1>
<p>Documentation is available at <a href="../XAO/_classes_XAO_Transformer_php.html">XAO_Transformer.php</a></p>
<div class="src-code">
<pre><a name="a1"></a><br />1     <strong>&lt;?php</strong><a name="a2"></a><br />2     <a name="a3"></a><br />3     <font color="#009999">/******************************************************************************\</font><a name="a4"></a><br />4     <font color="#009999">* IMPORT REQUIRED CLASSES</font><a name="a5"></a><br />5     <font color="#009999">\******************************************************************************/</font><a name="a6"></a><br />6     <a name="a7"></a><br />7     <font color="#009999">/**</font><a name="a8"></a><br />8     <font color="#009999">* Import the root (base) XAO class.</font><a name="a9"></a><br />9     <font color="#009999">* </font><a name="a10"></a><br />10    <font color="#009999">* All classes in the XAO library should have this class at the top of their</font><a name="a11"></a><br />11    <font color="#009999">* inheritance tree. See documentation on the class itself for more details.</font><a name="a12"></a><br />12    <font color="#009999">* Including the following DomDoc class will automatically include the XaoRoot</font><a name="a13"></a><br />13    <font color="#009999">* definition, however, it is included here for clarity and completeness.</font><a name="a14"></a><br />14    <font color="#009999">*</font><a name="a15"></a><br />15    <font color="#009999">*</font><font color="#009999"> </font><strong><font color="#009999">@import</font></strong><font color="#009999"> XaoRoot</font><a name="a16"></a><br />16    <font color="#009999">*/</font><a name="a17"></a><br />17    <font color="#800000">include_once</font> <font color="#ff702b">&quot;XAO_XaoRoot.php&quot;</font>;<a name="a18"></a><br />18    <a name="a19"></a><br />19    <font color="#009999">/**</font><a name="a20"></a><br />20    <font color="#009999">* Import the basic DomDoc class for inheritance.</font><a name="a21"></a><br />21    <font color="#009999">* </font><a name="a22"></a><br />22    <font color="#009999">* This class is based on DomDoc and hence supports all of it's functionality,</font><a name="a23"></a><br />23    <font color="#009999">* including it's ability to be consumed by another DomDoc based object.</font><a name="a24"></a><br />24    <font color="#009999">* </font><a name="a25"></a><br />25    <font color="#009999">*</font><font color="#009999"> </font><strong><font color="#009999">@import</font></strong><font color="#009999"> DomDoc</font><a name="a26"></a><br />26    <font color="#009999">*/</font><a name="a27"></a><br />27    <font color="#800000">include_once</font> <font color="#ff702b">&quot;XAO_DomDoc.php&quot;</font>;<a name="a28"></a><br />28    <a name="a29"></a><br />29    <font color="#009999">/**</font><a name="a30"></a><br />30    <font color="#009999">* Import an XML parsing utility class used for debugging XML errors.</font><a name="a31"></a><br />31    <font color="#009999">* </font><a name="a32"></a><br />32    <font color="#009999">*</font><font color="#009999"> </font><strong><font color="#009999">@import</font></strong><font color="#009999"> DomDoc</font><a name="a33"></a><br />33    <font color="#009999">*/</font><a name="a34"></a><br />34    <font color="#800000">include_once</font> <font color="#ff702b">&quot;XAO_DomFactory.php&quot;</font>;<a name="a35"></a><br />35    <a name="a36"></a><br />36    <font color="#009999">/**</font><a name="a37"></a><br />37    <font color="#009999">* Utility performing XSLT transformations</font><a name="a38"></a><br />38    <font color="#009999">*</font><a name="a39"></a><br />39    <font color="#009999">* This class encapsulates comprehensive XSLT functionality. It makes available</font><a name="a40"></a><br />40    <font color="#009999">* multiple (pluggable) transformation engines through a unified, simplified API.</font><a name="a41"></a><br />41    <font color="#009999">*</font><a name="a42"></a><br />42    <font color="#009999">*</font><font color="#009999"> </font><strong><font color = "#0099FF">@author</font></strong><font color="#009999">       Terence Kearns</font><a name="a43"></a><br />43    <font color="#009999">*</font><font color="#009999"> </font><strong><font color = "#0099FF">@version</font></strong><font color="#009999">      0.0</font><a name="a44"></a><br />44    <font color="#009999">*</font><font color="#009999"> </font><strong><font color = "#0099FF">@copyright</font></strong><font color="#009999">    Terence Kearns 2003</font><a name="a45"></a><br />45    <font color="#009999">*</font><font color="#009999"> </font><strong><font color = "#0099FF">@license</font></strong><font color="#009999">      Apache 2.0</font><a name="a46"></a><br />46    <font color="#009999">*</font><font color="#009999"> </font><strong><font color = "#0099FF">@package</font></strong><font color="#009999">      XAO</font><a name="a47"></a><br />47    <font color="#009999">*</font><font color="#009999"> </font><strong><font color = "#0099FF">@link</font></strong><font color="#009999">         http://github.com/tezza1971/XAO-PHP</font><a name="a48"></a><br />48    <font color="#009999">*/</font><a name="a49"></a><br />49    <font color="blue">class</font> <a href="../XAO/Transformer.html">Transformer</a> <font color="blue">extends</font> <a href="../XAO/XaoRoot.html">XaoRoot</a> <strong>{</strong><a name="a50"></a><br />50    <a name="a51"></a><br />51        <font color="#009999">/**</font><a name="a52"></a><br />52    <font color="#009999">    * DOM XML object instance of the source document</font><a name="a53"></a><br />53    <font color="#009999">    * </font><a name="a54"></a><br />54    <font color="#009999">    * This has to be specified in the constructor. The Transformer class will</font><a name="a55"></a><br />55    <font color="#009999">    * not work without this object and a DOM XML instnace of the stylsheet.</font><a name="a56"></a><br />56    <font color="#009999">    * The constructor may need to ensure this object eventuates by parsing</font><a name="a57"></a><br />57    <font color="#009999">    * in external XML data - same applies for the stylesheet.</font><a name="a58"></a><br />58    <font color="#009999">    *</font><a name="a59"></a><br />59    <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@access</font></strong><font color="#009999">   public</font><a name="a60"></a><br />60    <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@var </font></strong><font color="#009999">     </font><em>object </em><font color="#009999"></font><a name="a61"></a><br />61    <font color="#009999">    */</font><a name="a62"></a><br />62        <font color="blue">var</font> <a href="../XAO/Transformer.html#var$objSrc">$objSrc</a>;<a name="a63"></a><br />63        <a name="a64"></a><br />64        <font color="#009999">/**</font><a name="a65"></a><br />65    <font color="#009999">    * Root element of source document object</font><a name="a66"></a><br />66    <font color="#009999">    * </font><a name="a67"></a><br />67    <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@access</font></strong><font color="#009999">   public</font><a name="a68"></a><br />68    <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@var </font></strong><font color="#009999">     </font><em>node </em><a name="a69"></a><br />69    <font color="#009999">    */</font><a name="a70"></a><br />70        <font color="blue">var</font> <a href="../XAO/Transformer.html#var$ndSrcRoot">$ndSrcRoot</a>;<a name="a71"></a><br />71    <a name="a72"></a><br />72        <font color="#009999">/**</font><a name="a73"></a><br />73    <font color="#009999">    * DOM XML object instance of stylsheet used in transformation</font><a name="a74"></a><br />74    <font color="#009999">    * </font><a name="a75"></a><br />75    <font color="#009999">    * This has to be specified in the constructor. The Transformer class will</font><a name="a76"></a><br />76    <font color="#009999">    * not work without this object and a DOM XML instnace of the source doc.</font><a name="a77"></a><br />77    <font color="#009999">    * The constructor may need to ensure this object eventuates by parsing</font><a name="a78"></a><br />78    <font color="#009999">    * in external XML data - same applies for the source doc.</font><a name="a79"></a><br />79    <font color="#009999">    *</font><a name="a80"></a><br />80    <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@access</font></strong><font color="#009999">   public</font><a name="a81"></a><br />81    <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@var </font></strong><font color="#009999">     </font><em>object </em><font color="#009999"></font><a name="a82"></a><br />82    <font color="#009999">    */</font><a name="a83"></a><br />83        <font color="blue">var</font> <a href="../XAO/Transformer.html#var$objStyle">$objStyle</a>;<a name="a84"></a><br />84        <a name="a85"></a><br />85        <font color="#009999">/**</font><a name="a86"></a><br />86    <font color="#009999">    * Root element of source document object</font><a name="a87"></a><br />87    <font color="#009999">    * </font><a name="a88"></a><br />88    <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@access</font></strong><font color="#009999">   public</font><a name="a89"></a><br />89    <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@var </font></strong><font color="#009999">     </font><em>node </em><a name="a90"></a><br />90    <font color="#009999">    */</font><a name="a91"></a><br />91        <font color="blue">var</font> <a href="../XAO/Transformer.html#var$ndStyleRoot">$ndStyleRoot</a>;<a name="a92"></a><br />92    <a name="a93"></a><br />93        <font color="blue">var</font> <a href="../XAO/Transformer.html#var$_uriStyleSheet">$_uriStyleSheet</a>;<a name="a94"></a><br />94        <a name="a95"></a><br />95        <font color="#009999">/**</font><a name="a96"></a><br />96    <font color="#009999">    * List of XSL parameters to be passed to the XSLT processor</font><a name="a97"></a><br />97    <font color="#009999">    *</font><a name="a98"></a><br />98    <font color="#009999">    * Usually these will be set by the application class which inherits DomDoc.</font><a name="a99"></a><br />99    <font color="#009999">    * The transform methods of this class should use this associative array to</font><a name="a100"></a><br />100   <font color="#009999">    * add these parameters to the processor.</font><a name="a101"></a><br />101   <font color="#009999">    * WARNING: RELYING ON THIS METHOD OF SETTING XSL PARAMS WILL MAKE YOUR</font><a name="a102"></a><br />102   <font color="#009999">    * STYLSHEET INCOMPATIBLE WITH CLIENT-SIDE TRANSFORMATION.</font><a name="a103"></a><br />103   <font color="#009999">    * IMPORTANT NOTE: YOUR PARAMS WILL NOT BE AVAILABLE IN YOUR STYLSHEET IF</font><a name="a104"></a><br />104   <font color="#009999">    * YOU DO NOT DECLARE THEM (WITH EMPTY VALUES). THE PROCESSOR WILL ONLY FEED</font><a name="a105"></a><br />105   <font color="#009999">    * PARAM VALUES TO THE STYLESHEET BY OVERRIDING THE VALUES OF EXISTING ONES.</font><a name="a106"></a><br />106   <font color="#009999">    *</font><a name="a107"></a><br />107   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@access</font></strong><font color="#009999">   public</font><a name="a108"></a><br />108   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@var </font></strong><font color="#009999">     </font><em>array </em><a name="a109"></a><br />109   <font color="#009999">    */</font><a name="a110"></a><br />110       <font color="blue">var</font> <a href="../XAO/Transformer.html#var$arrXslParams">$arrXslParams</a> = array<strong>(</strong><strong>)</strong>;<a name="a111"></a><br />111   <a name="a112"></a><br />112       <font color="#009999">/**</font><a name="a113"></a><br />113   <font color="#009999">    * Which XSLT processor to use</font><a name="a114"></a><br />114   <font color="#009999">    * </font><a name="a115"></a><br />115   <font color="#009999">    * This option allows the user to choose which implemented XSLT processor</font><a name="a116"></a><br />116   <font color="#009999">    * to employ. At this stage, possible choices are:</font><a name="a117"></a><br />117   <font color="#009999">    * - SABLOTRON which uses the xslt_ functions built into PHP.</font><a name="a118"></a><br />118   <font color="#009999">    * - DOMXML which uses the experimental transformation capabilities of the</font><a name="a119"></a><br />119   <font color="#009999">    *   native PHP domxml extension itself.</font><a name="a120"></a><br />120   <font color="#009999">    * Future implementations could use external procesors which may be Java,</font><a name="a121"></a><br />121   <font color="#009999">    * Com, or command-line executables.</font><a name="a122"></a><br />122   <font color="#009999">    *</font><a name="a123"></a><br />123   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@access</font></strong><font color="#009999">   public</font><a name="a124"></a><br />124   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@var </font></strong><font color="#009999">     </font><em>string </em><a name="a125"></a><br />125   <font color="#009999">    */</font><a name="a126"></a><br />126       <font color="blue">var</font> <a href="../XAO/Transformer.html#var$strXsltProcessor">$strXsltProcessor</a> = <font color="#ff702b">&quot;DOMXML&quot;</font>;<a name="a127"></a><br />127       <a name="a128"></a><br />128       <font color="#009999">/**</font><a name="a129"></a><br />129   <font color="#009999">    * XSLT processing result container</font><a name="a130"></a><br />130   <font color="#009999">    * </font><a name="a131"></a><br />131   <font color="#009999">    * Regardless of which XSLT processor is used, the result is always stored</font><a name="a132"></a><br />132   <font color="#009999">    * in this variable AS A STRING.</font><a name="a133"></a><br />133   <font color="#009999">    *</font><a name="a134"></a><br />134   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@access</font></strong><font color="#009999">   public</font><a name="a135"></a><br />135   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@var </font></strong><font color="#009999">     </font><em>string </em><a name="a136"></a><br />136   <font color="#009999">    */</font><a name="a137"></a><br />137       <font color="blue">var</font> <a href="../XAO/Transformer.html#var$strXsltResult">$strXsltResult</a>;<a name="a138"></a><br />138   <a name="a139"></a><br />139       <font color="#009999">/**</font><a name="a140"></a><br />140   <font color="#009999">    * Transformer constructor</font><a name="a141"></a><br />141   <font color="#009999">    *</font><a name="a142"></a><br />142   <font color="#009999">    * The main job here is to parse the source XML and the XSLT as DOM XML</font><a name="a143"></a><br />143   <font color="#009999">    * objects. Note that this technique incurs unneccesary overhead for</font><a name="a144"></a><br />144   <font color="#009999">    * tranform processors like sablotron. But this is neccesary to maintain</font><a name="a145"></a><br />145   <font color="#009999">    * the simplicity of the API - it's a trade-off!</font><a name="a146"></a><br />146   <font color="#009999">    * The stylesheet and the XML source can be supplied in one of three formats:</font><a name="a147"></a><br />147   <font color="#009999">    * 1) DOM XML object (preferrred)</font><a name="a148"></a><br />148   <font color="#009999">    * 2) file URI</font><a name="a149"></a><br />149   <font color="#009999">    * 3) well formed ascii data</font><a name="a150"></a><br />150   <font color="#009999">    *</font><a name="a151"></a><br />151   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@param </font></strong><font color="#009999">   </font><em>mixed </em><font color="#009999">  </font><font color="#009999">starting XML source data</font><a name="a152"></a><br />152   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@param </font></strong><font color="#009999">   </font><em>mixed </em><font color="#009999">  </font><font color="#009999">starting stylsheet</font><a name="a153"></a><br />153   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@return </font></strong><font color="#009999">  </font><em>void </em><a name="a154"></a><br />154   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@access</font></strong><font color="#009999">   public</font><a name="a155"></a><br />155   <font color="#009999">    */</font><a name="a156"></a><br />156       <font color="blue">function</font> <a href="../XAO/Transformer.html#methodTransformer">Transformer</a><strong>(</strong><strong>&amp;</strong><strong><font color="#008000">$mxdSrc</font></strong><strong>,</strong><strong>&amp;</strong><strong><font color="#008000">$mxdStyle</font></strong><strong>)</strong> <strong>{</strong><a name="a157"></a><br />157           <a name="a158"></a><br />158                                           <font color="#a0a0a4">// set up source XML document</font><a name="a159"></a><br />159           <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/is_string">is_string</a><strong>(</strong><strong><font color="#008000">$mxdSrc</font></strong><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a160"></a><br />160   <a name="a161"></a><br />161               <strong><font color="#008000">$objDomFactory</font></strong> =<strong>&amp;</strong> new <a href="../XAO/DomFactory.html">DomFactory</a><strong>(</strong><strong><font color="#008000">$mxdSrc</font></strong><strong>)</strong>;<a name="a162"></a><br />162               <a name="a163"></a><br />163               <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/strlen">strlen</a><strong>(</strong><strong><font color="#008000">$objDomFactory</font></strong><strong>-&gt;</strong>strErrorMsg<strong>)</strong><strong>)</strong> <strong>{</strong><a name="a164"></a><br />164                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#var$strDebugData">strDebugData</a> = <strong><font color="#008000">$objDomFactory</font></strong><strong>-&gt;</strong>strDebugData;<a name="a165"></a><br />165                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><a name="a166"></a><br />166                       <strong><font color="#008000">$objDomFactory</font></strong><strong>-&gt;</strong>strErrorMsgFull<strong>,</strong><a name="a167"></a><br />167                       <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><a name="a168"></a><br />168                   <strong>)</strong>;<a name="a169"></a><br />169               <strong>}</strong><a name="a170"></a><br />170               else <strong>{</strong><a name="a171"></a><br />171                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objSrc">objSrc</a> =<strong>&amp;</strong> <strong><font color="#008000">$objDomFactory</font></strong><strong>-&gt;</strong>objGetObjDoc<strong>(</strong><strong>)</strong>;<a name="a172"></a><br />172               <strong>}</strong><a name="a173"></a><br />173           <strong>}</strong><a name="a174"></a><br />174           elseif<strong>(</strong><a href="http://www.php.net/is_object">is_object</a><strong>(</strong><strong><font color="#008000">$mxdSrc</font></strong><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a175"></a><br />175               <strong><font color="#008000">$ndTest</font></strong> = <strong><font color="#008000">$mxdSrc</font></strong><strong>-&gt;</strong>document_element<strong>(</strong><strong>)</strong><a name="a176"></a><br />176                   OR <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><a name="a177"></a><br />177                       <font color="#ff702b">&quot;Transformer: Object is not a PHP DOM XML object.&quot;</font><strong>,</strong><a name="a178"></a><br />178                       <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><a name="a179"></a><br />179                   <strong>)</strong>;<a name="a180"></a><br />180               <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/is_object">is_object</a><strong>(</strong><strong><font color="#008000">$ndTest</font></strong><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a181"></a><br />181                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objSrc">objSrc</a> =<strong>&amp;</strong> <strong><font color="#008000">$mxdSrc</font></strong>;<a name="a182"></a><br />182                   <font color="#a0a0a4">//var_dump($ndTest);</font><a name="a183"></a><br />183                   <font color="#a0a0a4">//die();</font><a name="a184"></a><br />184               <strong>}</strong><a name="a185"></a><br />185               else <strong>{</strong><a name="a186"></a><br />186                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><a name="a187"></a><br />187                       <font color="#ff702b">&quot;Transformer: DOM XML object does not have a root element&quot;</font><strong>,</strong><a name="a188"></a><br />188                       <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><a name="a189"></a><br />189                   <strong>)</strong>;<a name="a190"></a><br />190               <strong>}</strong><a name="a191"></a><br />191           <strong>}</strong><a name="a192"></a><br />192           else <strong>{</strong><a name="a193"></a><br />193               <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/is_null">is_null</a><strong>(</strong><strong><font color="#008000">$mxdSrc</font></strong><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a194"></a><br />194                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><a name="a195"></a><br />195                       <font color="#ff702b">&quot;Transformer: NULL source XML argument&quot;</font><strong>,</strong><a name="a196"></a><br />196                       <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><a name="a197"></a><br />197                   <strong>)</strong>;<a name="a198"></a><br />198               <strong>}</strong><a name="a199"></a><br />199               else <strong>{</strong><a name="a200"></a><br />200                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><a name="a201"></a><br />201                       <font color="#ff702b">&quot;Transformer: Invalid source XML argument&quot;</font><strong>,</strong><a name="a202"></a><br />202                       <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><a name="a203"></a><br />203                   <strong>)</strong>;<a name="a204"></a><br />204               <strong>}</strong><a name="a205"></a><br />205           <strong>}</strong><a name="a206"></a><br />206           <a name="a207"></a><br />207                                           <font color="#a0a0a4">// set up transformation document</font><a name="a208"></a><br />208           <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/is_string">is_string</a><strong>(</strong><strong><font color="#008000">$mxdStyle</font></strong><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a209"></a><br />209               <a name="a210"></a><br />210               <strong><font color="#008000">$objDomFactory</font></strong> =<strong>&amp;</strong> new <a href="../XAO/DomFactory.html">DomFactory</a><strong>(</strong><strong><font color="#008000">$mxdStyle</font></strong><strong>)</strong>;<a name="a211"></a><br />211               <a name="a212"></a><br />212               <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/strlen">strlen</a><strong>(</strong><strong><font color="#008000">$objDomFactory</font></strong><strong>-&gt;</strong>strErrorMsg<strong>)</strong><strong>)</strong> <strong>{</strong><a name="a213"></a><br />213                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#var$strDebugData">strDebugData</a> = <strong><font color="#008000">$objDomFactory</font></strong><strong>-&gt;</strong>strDebugData;<a name="a214"></a><br />214                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><a name="a215"></a><br />215                       <strong><font color="#008000">$objDomFactory</font></strong><strong>-&gt;</strong>strErrorMsgFull<strong>,</strong><a name="a216"></a><br />216                       <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><a name="a217"></a><br />217                   <strong>)</strong>;<a name="a218"></a><br />218               <strong>}</strong><a name="a219"></a><br />219               else <strong>{</strong><a name="a220"></a><br />220                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objStyle">objStyle</a> =<strong>&amp;</strong> <strong><font color="#008000">$objDomFactory</font></strong><strong>-&gt;</strong>objGetObjDoc<strong>(</strong><strong>)</strong>;<a name="a221"></a><br />221               <strong>}</strong><a name="a222"></a><br />222               <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$_uriStyleSheet">_uriStyleSheet</a> = <strong><font color="#008000">$objDomFactory</font></strong><strong>-&gt;</strong>uriContextFile;<a name="a223"></a><br />223           <strong>}</strong><a name="a224"></a><br />224           elseif<strong>(</strong><a href="http://www.php.net/is_object">is_object</a><strong>(</strong><strong><font color="#008000">$mxdStyle</font></strong><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a225"></a><br />225               <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objStyle">objStyle</a> =<strong>&amp;</strong> <strong><font color="#008000">$mxdStyle</font></strong>;<a name="a226"></a><br />226           <strong>}</strong><a name="a227"></a><br />227           else <strong>{</strong><a name="a228"></a><br />228               <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/is_null">is_null</a><strong>(</strong><strong><font color="#008000">$mxdStyle</font></strong><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a229"></a><br />229                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><a name="a230"></a><br />230                       <font color="#ff702b">&quot;Transformer: NULL stylesheet argument&quot;</font><strong>,</strong><a name="a231"></a><br />231                       <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><a name="a232"></a><br />232                   <strong>)</strong>;<a name="a233"></a><br />233               <strong>}</strong><a name="a234"></a><br />234               else <strong>{</strong><a name="a235"></a><br />235                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><a name="a236"></a><br />236                       <font color="#ff702b">&quot;Transformer: Invalid stylesheet argument&quot;</font><strong>,</strong><a name="a237"></a><br />237                       <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><a name="a238"></a><br />238                   <strong>)</strong>;<a name="a239"></a><br />239               <strong>}</strong><a name="a240"></a><br />240           <strong>}</strong><a name="a241"></a><br />241           <a name="a242"></a><br />242           <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/is_object">is_object</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objStyle">objStyle</a><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a243"></a><br />243               <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$ndStyleRoot">ndStyleRoot</a> =<strong>&amp;</strong> <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objStyle">objStyle</a><strong>-&gt;</strong>document_element<strong>(</strong><strong>)</strong>;<a name="a244"></a><br />244           <strong>}</strong><a name="a245"></a><br />245           <a name="a246"></a><br />246           <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/is_object">is_object</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objSrc">objSrc</a><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a247"></a><br />247               <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$ndSrcRoot">ndSrcRoot</a> =<strong>&amp;</strong> <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objSrc">objSrc</a><strong>-&gt;</strong>document_element<strong>(</strong><strong>)</strong>;<a name="a248"></a><br />248           <strong>}</strong><a name="a249"></a><br />249       <strong>}</strong><a name="a250"></a><br />250       <a name="a251"></a><br />251       <font color="blue">function</font> <a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><strong><font color="#008000">$strErrMsg</font></strong><strong>,</strong><strong><font color="#008000">$arrAttribs</font></strong> = null<strong>)</strong> <strong>{</strong><a name="a252"></a><br />252           parent<strong>::</strong><a href="../XAO/XaoRoot.html#methodThrow">Throw</a><strong>(</strong><strong><font color="#008000">$strErrMsg</font></strong><strong>,</strong><strong><font color="#008000">$arrAttribs</font></strong><strong>)</strong>;<a name="a253"></a><br />253                                           <font color="#a0a0a4">// This is probably the ONLY place you </font><a name="a254"></a><br />254                                           <font color="#a0a0a4">// will see a die() statement. This is</font><a name="a255"></a><br />255                                           <font color="#a0a0a4">// because normally, errors are </font><a name="a256"></a><br />256                                           <font color="#a0a0a4">// displayed by way of a stylsheet </font><a name="a257"></a><br />257                                           <font color="#a0a0a4">// template. However if transformation</font><a name="a258"></a><br />258                                           <font color="#a0a0a4">// cannot take place, then the exception</font><a name="a259"></a><br />259                                           <font color="#a0a0a4">// will never be displayed.</font><a name="a260"></a><br />260                                           <font color="#a0a0a4">// Exceptions should never be dealt with</font><a name="a261"></a><br />261                                           <font color="#a0a0a4">// like this. This is a last resort.</font><a name="a262"></a><br />262           <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/strlen">strlen</a><strong>(</strong><a href="http://www.php.net/trim">trim</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#var$strDebugData">strDebugData</a><strong>)</strong><strong>)</strong><strong>)</strong> <a name="a263"></a><br />263               die<strong>(</strong><font color="#ff702b">&quot;&lt;br /&gt;\n&quot;</font>.<strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#var$strError">strError</a>.<strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#var$strDebugData">strDebugData</a><strong>)</strong>;<a name="a264"></a><br />264       <strong>}</strong><a name="a265"></a><br />265       <a name="a266"></a><br />266       <font color="blue">function</font> <a href="../XAO/Transformer.html#methodSetXslParam">SetXslParam</a><strong>(</strong><strong><font color="#008000">$strName</font></strong><strong>,</strong><strong><font color="#008000">$strValue</font></strong><strong>)</strong> <strong>{</strong><a name="a267"></a><br />267                                           <font color="#a0a0a4">// This test should be improved to use</font><a name="a268"></a><br />268                                           <font color="#a0a0a4">// a regex which properly check for </font><a name="a269"></a><br />269                                           <font color="#a0a0a4">// stylesheet param name legality</font><a name="a270"></a><br />270           <font color="blue">if</font><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodblnTestSafeName">blnTestSafeName</a><strong>(</strong><strong><font color="#008000">$strName</font></strong><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a271"></a><br />271               <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$arrXslParams">arrXslParams</a><strong>[</strong><strong><font color="#008000">$strName</font></strong><strong>]</strong> = <strong><font color="#008000">$strValue</font></strong>;<a name="a272"></a><br />272           <strong>}</strong><a name="a273"></a><br />273           else <strong>{</strong><a name="a274"></a><br />274               <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><a name="a275"></a><br />275                   <font color="#ff702b">&quot;Please specify a valid XSL parameter name. &quot;</font><a name="a276"></a><br />276                   .<font color="#ff702b">&quot;Multiline, beginning with numbers, non-alpha-numeric &quot;</font><a name="a277"></a><br />277                   .<font color="#ff702b">&quot;characters are NOT allowed. An underscore is allowed.&quot;</font><strong>,</strong><a name="a278"></a><br />278                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><a name="a279"></a><br />279               <strong>)</strong>;<a name="a280"></a><br />280           <strong>}</strong><a name="a281"></a><br />281       <strong>}</strong><a name="a282"></a><br />282       <font color="#009999">/**</font><a name="a283"></a><br />283   <font color="#009999">    * Transform contents using stylsheet in $this-&gt;_uriStylSheet</font><a name="a284"></a><br />284   <font color="#009999">    *</font><a name="a285"></a><br />285   <font color="#009999">    * This function calls the Transformer class which takes a DomDoc in the</font><a name="a286"></a><br />286   <font color="#009999">    * first argument to the constructor as a reference. The Transformer object</font><a name="a287"></a><br />287   <font color="#009999">    * records any errors using the passed DomDoc's Throw() method (so the</font><a name="a288"></a><br />288   <font color="#009999">    * errors are bound to that source document). This function makes some</font><a name="a289"></a><br />289   <font color="#009999">    * decisions on how errors are released based on options set in $this</font><a name="a290"></a><br />290   <font color="#009999">    * DomDoc instance. Since a transformation result isn't always well-formed</font><a name="a291"></a><br />291   <font color="#009999">    * XML, the result is returned as a string. Here are the steps taken:</font><a name="a292"></a><br />292   <font color="#009999">    *  1) check for the existance of a stylsheet</font><a name="a293"></a><br />293   <font color="#009999">    *  2) route the request to the chosen XSLT processor member function</font><a name="a294"></a><br />294   <font color="#009999">    *  3) return the result.</font><a name="a295"></a><br />295   <font color="#009999">    *</font><a name="a296"></a><br />296   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@return </font></strong><font color="#009999">  </font><em>string </em><font color="#009999"> </font><font color="#009999">The contents of the transformation result or false</font><a name="a297"></a><br />297   <font color="#009999">    *</font><font color="#009999"> </font><font color="#009999">                   on failure</font><a name="a298"></a><br />298   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@access</font></strong><font color="#009999">   public</font><a name="a299"></a><br />299   <font color="#009999">    */</font><a name="a300"></a><br />300       <font color="blue">function</font> <a href="../XAO/Transformer.html#methodTransform">Transform</a><strong>(</strong><strong>)</strong> <strong>{</strong><a name="a301"></a><br />301                                           <font color="#a0a0a4">// provide a handy alternative for</font><a name="a302"></a><br />302                                           <font color="#a0a0a4">// client side access to server-side</font><a name="a303"></a><br />303                                           <font color="#a0a0a4">// XSL parameters.</font><a name="a304"></a><br />304           <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/count">count</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$arrXslParams">arrXslParams</a><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a305"></a><br />305                                           <font color="#a0a0a4">// establish XAO namespace prefix</font><a name="a306"></a><br />306               <strong><font color="#008000">$strPfx</font></strong> = <font color="#ff702b">&quot;&quot;</font>;<a name="a307"></a><br />307               <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/strlen">strlen</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#var$strXaoNamespacePrefix">strXaoNamespacePrefix</a><strong>)</strong><strong>)</strong><a name="a308"></a><br />308                   <strong><font color="#008000">$strPfx</font></strong> = <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#var$strXaoNamespacePrefix">strXaoNamespacePrefix</a>.<font color="#ff702b">&quot;:&quot;</font>;<a name="a309"></a><br />309                                           <font color="#a0a0a4">// set up container element for all </font><a name="a310"></a><br />310                                           <font color="#a0a0a4">// params</font><a name="a311"></a><br />311               <strong><font color="#008000">$ndParams</font></strong> = <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objSrc">objSrc</a><strong>-&gt;</strong>create_element<strong>(</strong><strong><font color="#008000">$strPfx</font></strong>.<font color="#ff702b">&quot;xslParams&quot;</font><strong>)</strong>;<a name="a312"></a><br />312               <strong><font color="#008000">$ndParams</font></strong> = <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$ndSrcRoot">ndSrcRoot</a><strong>-&gt;</strong>append_child<strong>(</strong><strong><font color="#008000">$ndParams</font></strong><strong>)</strong>;<a name="a313"></a><br />313                                           <font color="#a0a0a4">// create each param in this container</font><a name="a314"></a><br />314               <font color="blue">foreach</font><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$arrXslParams">arrXslParams</a> AS <strong><font color="#008000">$strName</font></strong> =&gt; <strong><font color="#008000">$strVal</font></strong><strong>)</strong> <strong>{</strong><a name="a315"></a><br />315                   <strong><font color="#008000">$ndParam</font></strong> = <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objSrc">objSrc</a><strong>-&gt;</strong>create_element<strong>(</strong><strong><font color="#008000">$strPfx</font></strong>.<font color="#ff702b">&quot;param&quot;</font><strong>)</strong>;<a name="a316"></a><br />316                   <strong><font color="#008000">$ndParam</font></strong> = <strong><font color="#008000">$ndParams</font></strong><strong>-&gt;</strong>append_child<strong>(</strong><strong><font color="#008000">$ndParam</font></strong><strong>)</strong>;<a name="a317"></a><br />317                   <strong><font color="#008000">$ndParam</font></strong><strong>-&gt;</strong>set_attribute<strong>(</strong><font color="#ff702b">&quot;name&quot;</font><strong>,</strong> <strong><font color="#008000">$strName</font></strong><strong>)</strong>;<a name="a318"></a><br />318                   <strong><font color="#008000">$ndParam</font></strong><strong>-&gt;</strong>set_content<strong>(</strong><strong><font color="#008000">$strVal</font></strong><strong>)</strong>;<a name="a319"></a><br />319               <strong>}</strong><a name="a320"></a><br />320           <strong>}</strong><a name="a321"></a><br />321           <a name="a322"></a><br />322           <strong><font color="#008000">$blnSuccess</font></strong> = false;<a name="a323"></a><br />323           <font color="blue">switch</font><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$strXsltProcessor">strXsltProcessor</a><strong>)</strong> <strong>{</strong><a name="a324"></a><br />324               case <font color="#ff702b">&quot;SABLOTRON&quot;</font>: <a name="a325"></a><br />325                   <strong><font color="#008000">$blnSuccess</font></strong> = <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong>_TransformWithSablotron<strong>(</strong><strong>)</strong>; <a name="a326"></a><br />326               break;<a name="a327"></a><br />327               case <font color="#ff702b">&quot;DOMXML&quot;</font>: <a name="a328"></a><br />328                   <strong><font color="#008000">$blnSuccess</font></strong> = <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong>_TransformWithDomxml<strong>(</strong><strong>)</strong>; <a name="a329"></a><br />329               break;<a name="a330"></a><br />330               default:<a name="a331"></a><br />331                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><a name="a332"></a><br />332                       <font color="#ff702b">&quot;Transform: &quot;</font>.<strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a name="a333"></a><br />333   <a href="../XAO/Transformer.html#var$strXsltProcessor">strXsltProcessor</a>                    .<font color="#ff702b">&quot;: Not a valid XSLT processor.&quot;</font><strong>,</strong><a name="a334"></a><br />334                       <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><a name="a335"></a><br />335                   <strong>)</strong>;<a name="a336"></a><br />336           <strong>}</strong><a name="a337"></a><br />337           <a name="a338"></a><br />338           <font color="blue">return</font> <strong><font color="#008000">$blnSuccess</font></strong>;<a name="a339"></a><br />339       <strong>}</strong><a name="a340"></a><br />340       <a name="a341"></a><br />341       <font color="#009999">/**</font><a name="a342"></a><br />342   <font color="#009999">    * DOMXML XSLT implementation</font><a name="a343"></a><br />343   <font color="#009999">    * </font><a name="a344"></a><br />344   <font color="#009999">    * This processor implementation uses the native PHP DOM XML processor. At</font><a name="a345"></a><br />345   <font color="#009999">    * the time or writing, it is experimental. I noticed that it fails on very</font><a name="a346"></a><br />346   <font color="#009999">    * basic functionality and that the error reporting has not yet been refined</font><a name="a347"></a><br />347   <font color="#009999">    * The major advantage with this processor is that it is bundled with PHP and</font><a name="a348"></a><br />348   <font color="#009999">    * no additional PHP extensions need to be enabled. It is not ready for use</font><a name="a349"></a><br />349   <font color="#009999">    * though - neither in a production environement or for development (due to</font><a name="a350"></a><br />350   <font color="#009999">    * poor error reporting). SABLOTRON is reccommended but requires the XSLT</font><a name="a351"></a><br />351   <font color="#009999">    * extension to be enabled.</font><a name="a352"></a><br />352   <font color="#009999">    * </font><a name="a353"></a><br />353   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@return </font></strong><font color="#009999">  </font><em>boolean </em><font color="#009999">  </font><font color="#009999">Success or failure (true/false).</font><a name="a354"></a><br />354   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@access</font></strong><font color="#009999">   private</font><a name="a355"></a><br />355   <font color="#009999">    */</font><a name="a356"></a><br />356       <font color="blue">function</font> _TransformWithDomxml<strong>(</strong><strong>)</strong> <strong>{</strong><a name="a357"></a><br />357                                           <font color="#a0a0a4">// adding XSL params from the server-</font><a name="a358"></a><br />358                                           <font color="#a0a0a4">// side has important subtlties. The</font><a name="a359"></a><br />359                                           <font color="#a0a0a4">// server should only *replace* existing</font><a name="a360"></a><br />360                                           <font color="#a0a0a4">// xsl params, and only ones that</font><a name="a361"></a><br />361                                           <font color="#a0a0a4">// exist immediately below the root.</font><a name="a362"></a><br />362                                           <font color="#a0a0a4">// This behaviour is at least consistent</font><a name="a363"></a><br />363                                           <font color="#a0a0a4">// with the Sablotron processor.</font><a name="a364"></a><br />364                                           <font color="#a0a0a4">// Also, any existing &quot;name&quot; attrib</font><a name="a365"></a><br />365                                           <font color="#a0a0a4">// should be removed since *either* the</font><a name="a366"></a><br />366                                           <font color="#a0a0a4">// &quot;name&quot; attrib *or* the content is</font><a name="a367"></a><br />367                                           <font color="#a0a0a4">// populated. We populate the element</font><a name="a368"></a><br />368                                           <font color="#a0a0a4">// content because it's easier than</font><a name="a369"></a><br />369                                           <font color="#a0a0a4">// having to create single-quoted </font><a name="a370"></a><br />370                                           <font color="#a0a0a4">// strings. It's probably safer anyway.</font><a name="a371"></a><br />371           <strong><font color="#008000">$strPrfx</font></strong> = <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$ndStyleRoot">ndStyleRoot</a><strong>-&gt;</strong>prefix<strong>(</strong><strong>)</strong>;<a name="a372"></a><br />372           <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/strlen">strlen</a><strong>(</strong><strong><font color="#008000">$strPrfx</font></strong><strong>)</strong><strong>)</strong> <strong><font color="#008000">$strPrfx</font></strong> .= <font color="#ff702b">&quot;:&quot;</font>;<a name="a373"></a><br />373           <strong><font color="#008000">$strPName</font></strong> = <strong><font color="#008000">$strPrfx</font></strong>.<font color="#ff702b">&quot;param&quot;</font>;<a name="a374"></a><br />374           <strong><font color="#008000">$arrExistParamNames</font></strong> = array<strong>(</strong><strong>)</strong>;<a name="a375"></a><br />375           <strong><font color="#008000">$arrNdExists</font></strong> =<strong>&amp;</strong> <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$ndStyleRoot">ndStyleRoot</a><strong>-&gt;</strong>child_nodes<strong>(</strong><strong>)</strong>;<a name="a376"></a><br />376           <font color="blue">foreach</font><strong>(</strong><strong><font color="#008000">$arrNdExists</font></strong> AS <strong><font color="#008000">$ndExists</font></strong><strong>)</strong> <strong>{</strong><a name="a377"></a><br />377               <font color="blue">if</font><strong>(</strong><strong><font color="#008000">$ndExists</font></strong><strong>-&gt;</strong>node_type<strong>(</strong><strong>)</strong> == <font color="#ff702b">&quot;domelement&quot;</font><strong>)</strong> <strong>{</strong><a name="a378"></a><br />378                   <font color="blue">if</font><strong>(</strong><strong><font color="#008000">$ndExists</font></strong><strong>-&gt;</strong>node_name<strong>(</strong><strong>)</strong> == <strong><font color="#008000">$strPName</font></strong><strong>)</strong> <strong>{</strong><a name="a379"></a><br />379                       <strong><font color="#008000">$strParamName</font></strong> = <strong><font color="#008000">$ndExists</font></strong><strong>-&gt;</strong>get_attribute<strong>(</strong><font color="#ff702b">&quot;name&quot;</font><strong>)</strong>;<a name="a380"></a><br />380                       <font color="blue">if</font><strong>(</strong>isset<strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$arrXslParams">arrXslParams</a><strong>[</strong><strong><font color="#008000">$strParamName</font></strong><strong>]</strong><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a381"></a><br />381                           <strong><font color="#008000">$ndExists</font></strong><strong>-&gt;</strong>set_content<strong>(</strong><a name="a382"></a><br />382                               <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$arrXslParams">arrXslParams</a><strong>[</strong><strong><font color="#008000">$strParamName</font></strong><strong>]</strong><a name="a383"></a><br />383                           <strong>)</strong>;<a name="a384"></a><br />384                           <strong><font color="#008000">$ndExists</font></strong><strong>-&gt;</strong>remove_attribute<strong>(</strong><font color="#ff702b">&quot;select&quot;</font><strong>)</strong>;<a name="a385"></a><br />385                       <strong>}</strong><a name="a386"></a><br />386                   <strong>}</strong><a name="a387"></a><br />387               <strong>}</strong><a name="a388"></a><br />388           <strong>}</strong><a name="a389"></a><br />389                                           <font color="#a0a0a4">// convert the DOM doc to a stylsheet</font><a name="a390"></a><br />390                                           <font color="#a0a0a4">// doc</font><a name="a391"></a><br />391           <font color="blue">if</font><strong>(</strong><strong>!</strong><strong><font color="#008000">$objStylesheet</font></strong> = <a href="http://www.php.net/domxml_xslt_stylesheet_doc">domxml_xslt_stylesheet_doc</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objStyle">objStyle</a><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a392"></a><br />392               <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$_uriStyleSheet">_uriStyleSheet</a>.<font color="#ff702b">&quot; </font><a name="a393"></a><br />393   <font color="#ff702b">                is an XML document but it is not a valid not a stylesheet.&quot;</font><strong>,</strong><a name="a394"></a><br />394                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><a name="a395"></a><br />395               <strong>)</strong>;<a name="a396"></a><br />396               <font color="blue">return</font> false;<a name="a397"></a><br />397           <strong>}</strong><a name="a398"></a><br />398                                           <font color="#a0a0a4">// Do the transformation and trap any</font><a name="a399"></a><br />399                                           <font color="#a0a0a4">// error output.</font><a name="a400"></a><br />400           <a href="http://www.php.net/ob_start">ob_start</a><strong>(</strong><strong>)</strong>;<a name="a401"></a><br />401               <strong><font color="#008000">$objDomResult</font></strong> =<strong>&amp;</strong> <strong><font color="#008000">$objStylesheet</font></strong><strong>-&gt;</strong>process<strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objSrc">objSrc</a><strong>)</strong>;<a name="a402"></a><br />402               <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#var$strDebugData">strDebugData</a> = <a href="http://www.php.net/ob_get_contents">ob_get_contents</a><strong>(</strong><strong>)</strong>;<a name="a403"></a><br />403           <a href="http://www.php.net/ob_end_clean">ob_end_clean</a><strong>(</strong><strong>)</strong>;<a name="a404"></a><br />404                                           <font color="#a0a0a4">// extract the results</font><a name="a405"></a><br />405           <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/is_object">is_object</a><strong>(</strong><strong><font color="#008000">$objDomResult</font></strong><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a406"></a><br />406               <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$strXsltResult">strXsltResult</a> =<strong>&amp;</strong> <strong><font color="#008000">$objDomResult</font></strong><strong>-&gt;</strong>dump_mem<strong>(</strong>true<strong>)</strong>;<a name="a407"></a><br />407               <font color="blue">return</font> true;<a name="a408"></a><br />408           <strong>}</strong><a name="a409"></a><br />409           else <strong>{</strong><a name="a410"></a><br />410               <strong><font color="#008000">$strErrMsg</font></strong> = <font color="#ff702b">&quot;There were errors while trying to transform the </font><a name="a411"></a><br />411   <font color="#ff702b">                document &lt;strong&gt;&quot;</font>.<strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$_uriStyleSheet">_uriStyleSheet</a>.<font color="#ff702b">&quot;&lt;/strong&gt; </font><a name="a412"></a><br />412   <font color="#ff702b">                using the &lt;strong&gt;DOMXML&lt;/strong&gt; processor. Be warned that this</font><a name="a413"></a><br />413   <font color="#ff702b">                processor is EXPERIMENTAL and should not be used. Error output</font><a name="a414"></a><br />414   <font color="#ff702b">                (below) not likely to be of much use.\n\n&quot;</font>.<strong><font color="#008000">$phpErr</font></strong>;<a name="a415"></a><br />415               <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><strong><font color="#008000">$strErrMsg</font></strong><strong>,</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><strong>)</strong>;<a name="a416"></a><br />416               <font color="blue">return</font> false;<a name="a417"></a><br />417           <strong>}</strong><a name="a418"></a><br />418       <strong>}</strong><a name="a419"></a><br />419       <a name="a420"></a><br />420       <font color="#009999">/**</font><a name="a421"></a><br />421   <font color="#009999">    * Use the built-in SABLOTRON processor to perform XSLT</font><a name="a422"></a><br />422   <font color="#009999">    *</font><a name="a423"></a><br />423   <font color="#009999">    * The Sablotron XSLT processor (from gingerall.com) is an extremely fast and</font><a name="a424"></a><br />424   <font color="#009999">    * stable transformation engine. The class sets the default processor to</font><a name="a425"></a><br />425   <font color="#009999">    * SABLOTRON but this assumes that the server has the XSLT extension to PHP</font><a name="a426"></a><br />426   <font color="#009999">    * enabled. If it is absolutely not possible to have this extension enabled,</font><a name="a427"></a><br />427   <font color="#009999">    * then your application class (which should inherit DomDoc) can set this to</font><a name="a428"></a><br />428   <font color="#009999">    * DOMXML in the constructor. There are a number of reasons why you do not</font><a name="a429"></a><br />429   <font color="#009999">    * want to do this - see the API documentation for _TransformWithDomxml()</font><a name="a430"></a><br />430   <font color="#009999">    *</font><a name="a431"></a><br />431   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@return </font></strong><font color="#009999">  </font><em>boolean </em><font color="#009999"></font><font color="#009999">Sucess or failure (true/false).</font><a name="a432"></a><br />432   <font color="#009999">    *</font><font color="#009999"> </font><strong><font color = "#0099FF">@access</font></strong><font color="#009999">   private</font><a name="a433"></a><br />433   <font color="#009999">    */</font><a name="a434"></a><br />434       <font color="blue">function</font> _TransformWithSablotron<strong>(</strong><strong>)</strong> <strong>{</strong><a name="a435"></a><br />435           <font color="blue">if</font><strong>(</strong><strong>!</strong><a href="http://www.php.net/extension_loaded">extension_loaded</a><strong>(</strong><font color="#ff702b">&quot;xslt&quot;</font><strong>)</strong><strong>)</strong> <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><a name="a436"></a><br />436               <font color="#ff702b">&quot;_TransformWithSablotron: This PHP server does have the XSLT &quot;</font><a name="a437"></a><br />437               .<font color="#ff702b">&quot;extension enabled.&quot;</font><strong>,</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><a name="a438"></a><br />438           <strong>)</strong>;<a name="a439"></a><br />439           <strong><font color="#008000">$xt</font></strong> = <strong>@</strong><a href="http://www.php.net/xslt_create">xslt_create</a><strong>(</strong><strong>)</strong> OR <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><a name="a440"></a><br />440               <font color="#ff702b">&quot;_TransformWithSablotron: Could not create an XSLT processor.&quot;</font><strong>,</strong><a name="a441"></a><br />441               <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><a name="a442"></a><br />442           <strong>)</strong>;<a name="a443"></a><br />443           <a href="http://www.php.net/xslt_set_error_handler">xslt_set_error_handler</a><strong>(</strong><strong><font color="#008000">$xt</font></strong><strong>,</strong>array<strong>(</strong><strong>&amp;</strong><strong><font color="#008000">$this</font></strong><strong>,</strong><font color="#ff702b">&quot;_SablotronErrorTrap&quot;</font><strong>)</strong><strong>)</strong>;<a name="a444"></a><br />444           <a name="a445"></a><br />445                                               <font color="#a0a0a4">// Sablotron has the ability to</font><a name="a446"></a><br />446                                               <font color="#a0a0a4">// register a base path location</font><a name="a447"></a><br />447                                               <font color="#a0a0a4">// which it can use to resolve</font><a name="a448"></a><br />448                                               <font color="#a0a0a4">// external entities such as import</font><a name="a449"></a><br />449                                               <font color="#a0a0a4">// and include directives.</font><a name="a450"></a><br />450                                               <font color="#a0a0a4">// Here, we provide the facility</font><a name="a451"></a><br />451                                               <font color="#a0a0a4">// but can only do so if the style-</font><a name="a452"></a><br />452                                               <font color="#a0a0a4">// sheet was specified via a URI - </font><a name="a453"></a><br />453                                               <font color="#a0a0a4">// in which case $this-&gt;_uriStyleSheet</font><a name="a454"></a><br />454                                               <font color="#a0a0a4">// is populated in the constructor.</font><a name="a455"></a><br />455           <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/file_exists">file_exists</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$_uriStyleSheet">_uriStyleSheet</a><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a456"></a><br />456                                               <font color="#a0a0a4">// sablotron requires a URI protocol</font><a name="a457"></a><br />457                                               <font color="#a0a0a4">// identifier for it's base path.</font><a name="a458"></a><br />458               <strong><font color="#008000">$uriBaseDir</font></strong> = <font color="#ff702b">&quot;file://&quot;</font>;<a name="a459"></a><br />459                                               <font color="#a0a0a4">// determine if the style URI is </font><a name="a460"></a><br />460                                               <font color="#a0a0a4">// relative or absolute.</font><a name="a461"></a><br />461               <font color="blue">if</font><strong>(</strong><a name="a462"></a><br />462                      <a href="http://www.php.net/substr">substr</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$_uriStyleSheet">_uriStyleSheet</a><strong>,</strong>0<strong>,</strong>1<strong>)</strong> != <font color="#ff702b">&quot;/&quot;</font><a name="a463"></a><br />463                   &amp;&amp; <a href="http://www.php.net/substr">substr</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$_uriStyleSheet">_uriStyleSheet</a><strong>,</strong>1<strong>,</strong>3<strong>)</strong> != <font color="#ff702b">&quot;:/&quot;</font><a name="a464"></a><br />464               <strong>)</strong> <strong>{</strong><a name="a465"></a><br />465                                               <font color="#a0a0a4">// if relative, use the contextual</font><a name="a466"></a><br />466                                               <font color="#a0a0a4">// path prepended to the style uri path</font><a name="a467"></a><br />467                   <strong><font color="#008000">$uriBaseDir</font></strong> .= <a name="a468"></a><br />468                       <a href="http://www.php.net/str_replace">str_replace</a><strong>(</strong><a name="a469"></a><br />469                           <font color="#ff702b">&quot;\\&quot;</font><strong>,</strong><a name="a470"></a><br />470                           <font color="#ff702b">&quot;/&quot;</font><strong>,</strong><a name="a471"></a><br />471                           <a href="http://www.php.net/dirname">dirname</a><strong>(</strong><a href="http://www.php.net/realpath">realpath</a><strong>(</strong><strong><font color="#008000">$_SERVER</font></strong><strong>[</strong><font color="#ff702b">&quot;PATH_TRANSLATED&quot;</font><strong>]</strong><strong>)</strong><strong>)</strong><a name="a472"></a><br />472                       <strong>)</strong>.<font color="#ff702b">&quot;/&quot;</font>;<a name="a473"></a><br />473               <strong>}</strong><a name="a474"></a><br />474                                               <font color="#a0a0a4">// ends with style path</font><a name="a475"></a><br />475               <strong><font color="#008000">$uriBaseDir</font></strong> .= <a href="http://www.php.net/dirname">dirname</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$_uriStyleSheet">_uriStyleSheet</a><strong>)</strong>.<font color="#ff702b">&quot;/&quot;</font>;<a name="a476"></a><br />476                                               <font color="#a0a0a4">// apply the base path</font><a name="a477"></a><br />477               <a href="http://www.php.net/xslt_set_base">xslt_set_base</a><strong>(</strong><strong><font color="#008000">$xt</font></strong><strong>,</strong><strong><font color="#008000">$uriBaseDir</font></strong><strong>)</strong>;<a name="a478"></a><br />478           <strong>}</strong><a name="a479"></a><br />479           <a name="a480"></a><br />480           <strong><font color="#008000">$args</font></strong> = array<strong>(</strong><a name="a481"></a><br />481               <font color="#ff702b">'/_xml'</font> =&gt; <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objSrc">objSrc</a><strong>-&gt;</strong>dump_mem<strong>(</strong><strong>)</strong><strong>,</strong> <a name="a482"></a><br />482               <font color="#ff702b">'/_xsl'</font> =&gt; <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objStyle">objStyle</a><strong>-&gt;</strong>dump_mem<strong>(</strong><strong>)</strong><a name="a483"></a><br />483           <strong>)</strong>;<a name="a484"></a><br />484   <a name="a485"></a><br />485           <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$strXsltResult">strXsltResult</a> = <strong>@</strong><a href="http://www.php.net/xslt_process">xslt_process</a><strong>(</strong><a name="a486"></a><br />486               <strong><font color="#008000">$xt</font></strong><strong>,</strong><a name="a487"></a><br />487               <font color="#ff702b">&quot;arg:/_xml&quot;</font><strong>,</strong><a name="a488"></a><br />488               <font color="#ff702b">&quot;arg:/_xsl&quot;</font><strong>,</strong><a name="a489"></a><br />489               null<strong>,</strong><a name="a490"></a><br />490               <strong><font color="#008000">$args</font></strong><strong>,</strong><a name="a491"></a><br />491               <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a name="a492"></a><br />492   <a href="../XAO/Transformer.html#var$arrXslParams">arrXslParams</a>        <strong>)</strong>;<a name="a493"></a><br />493           <a name="a494"></a><br />494           <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/strlen">strlen</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$strXsltResult">strXsltResult</a><strong>)</strong><strong>)</strong> <font color="blue">return</font> true;<a name="a495"></a><br />495           <a name="a496"></a><br />496           <font color="blue">return</font> false;<a name="a497"></a><br />497       <strong>}</strong><a name="a498"></a><br />498       <a name="a499"></a><br />499       <font color="blue">function</font> <a href="../XAO/Transformer.html#method_SablotronErrorTrap">_SablotronErrorTrap</a><strong>(</strong><a name="a500"></a><br />500           <strong><font color="#008000">$resSab</font></strong><strong>,</strong><a name="a501"></a><br />501           <strong><font color="#008000">$intSabErr</font></strong><strong>,</strong><a name="a502"></a><br />502           <strong><font color="#008000">$strSabLvl</font></strong><strong>,</strong><a name="a503"></a><br />503           <strong><font color="#008000">$arrSabErrData</font></strong><a name="a504"></a><br />504       <strong>)</strong> <strong>{</strong><a name="a505"></a><br />505           <strong><font color="#008000">$strMsg</font></strong> = <font color="#ff702b">&quot;Sablotron XSLT error &quot;</font>;<a name="a506"></a><br />506                                           <font color="#a0a0a4">// if applicable, reveal the location</font><a name="a507"></a><br />507                                           <font color="#a0a0a4">// of the stylsheet in use.</font><a name="a508"></a><br />508           <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/strlen">strlen</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$_uriStyleSheet">_uriStyleSheet</a><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a509"></a><br />509               <strong><font color="#008000">$strMsg</font></strong> .= <font color="#ff702b">&quot; while transforming file &lt;b&gt;&quot;</font><a name="a510"></a><br />510                   .<strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$_uriStyleSheet">_uriStyleSheet</a>.<font color="#ff702b">&quot;&lt;/b&gt;&quot;</font>;<a name="a511"></a><br />511           <strong>}</strong><a name="a512"></a><br />512                                           <font color="#a0a0a4">// default debug text is stylsheet</font><a name="a513"></a><br />513           <strong><font color="#008000">$xslData</font></strong> =<strong>&amp;</strong> <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objStyle">objStyle</a><strong>-&gt;</strong>dump_mem<strong>(</strong>true<strong>)</strong>;<a name="a514"></a><br />514                                           <font color="#a0a0a4">// assume that $xalData is the data in</font><a name="a515"></a><br />515                                           <font color="#a0a0a4">// context for the Sablotron error.</font><a name="a516"></a><br />516           <strong><font color="#008000">$blnHaveTheRightFile</font></strong> = true;<a name="a517"></a><br />517                                           <font color="#a0a0a4">// cater for errors occuring in </font><a name="a518"></a><br />518                                           <font color="#a0a0a4">// external files processed by Sablotron</font><a name="a519"></a><br />519           <font color="blue">if</font><strong>(</strong>isset<strong>(</strong><strong><font color="#008000">$arrSabErrData</font></strong><strong>[</strong><font color="#ff702b">&quot;URI&quot;</font><strong>]</strong><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a520"></a><br />520               <font color="blue">if</font><strong>(</strong><strong><font color="#008000">$arrSabErrData</font></strong><strong>[</strong><font color="#ff702b">&quot;URI&quot;</font><strong>]</strong> != <font color="#ff702b">&quot;arg:/_xsl&quot;</font><strong>)</strong> <strong>{</strong><a name="a521"></a><br />521                                           <font color="#a0a0a4">// The data in context is different</font><a name="a522"></a><br />522                   <strong><font color="#008000">$blnHaveTheRightFile</font></strong> = false;<a name="a523"></a><br />523                   <strong><font color="#008000">$strMsg</font></strong> .= <font color="#ff702b">&quot;&lt;div&gt;Actual error occured while processing external&quot;</font><a name="a524"></a><br />524                   .<font color="#ff702b">&quot; entity: &lt;b&gt;&quot;</font>.<strong><font color="#008000">$arrSabErrData</font></strong><strong>[</strong><font color="#ff702b">&quot;URI&quot;</font><strong>]</strong>.<font color="#ff702b">&quot;&lt;/b&gt;&lt;/div&gt;&quot;</font>;<a name="a525"></a><br />525                   <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/preg_match">preg_match</a><strong>(</strong><font color="#ff702b">&quot;/file\:\/\//i&quot;</font><strong>,</strong><strong><font color="#008000">$arrSabErrData</font></strong><strong>[</strong><font color="#ff702b">&quot;URI&quot;</font><strong>]</strong><strong>)</strong><strong>)</strong><a name="a526"></a><br />526                       <strong><font color="#008000">$arrSabErrData</font></strong><strong>[</strong><font color="#ff702b">&quot;URI&quot;</font><strong>]</strong> = <a name="a527"></a><br />527                           <a href="http://www.php.net/substr">substr</a><strong>(</strong><strong><font color="#008000">$arrSabErrData</font></strong><strong>[</strong><font color="#ff702b">&quot;URI&quot;</font><strong>]</strong><strong>,</strong><a href="http://www.php.net/strlen">strlen</a><strong>(</strong><font color="#ff702b">&quot;file://&quot;</font><strong>)</strong><strong>)</strong>;<a name="a528"></a><br />528                   <font color="blue">if</font><strong>(</strong><a href="http://www.php.net/file_exists">file_exists</a><strong>(</strong><strong><font color="#008000">$arrSabErrData</font></strong><strong>[</strong><font color="#ff702b">&quot;URI&quot;</font><strong>]</strong><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a529"></a><br />529                                           <font color="#a0a0a4">// change the debug text to the</font><a name="a530"></a><br />530                                           <font color="#a0a0a4">// external file contents.</font><a name="a531"></a><br />531                       <strong><font color="#008000">$xslData</font></strong> = <a href="http://www.php.net/implode">implode</a><strong>(</strong><font color="#ff702b">&quot;&quot;</font><strong>,</strong><a href="http://www.php.net/file">file</a><strong>(</strong><strong><font color="#008000">$arrSabErrData</font></strong><strong>[</strong><font color="#ff702b">&quot;URI&quot;</font><strong>]</strong><strong>)</strong><strong>)</strong>;<a name="a532"></a><br />532                                           <font color="#a0a0a4">// we've managed to obtain the correct</font><a name="a533"></a><br />533                                           <font color="#a0a0a4">// data in context</font><a name="a534"></a><br />534                       <strong><font color="#008000">$blnHaveTheRightFile</font></strong> = true;<a name="a535"></a><br />535                   <strong>}</strong><a name="a536"></a><br />536               <strong>}</strong><a name="a537"></a><br />537           <strong>}</strong><a name="a538"></a><br />538                                           <font color="#a0a0a4">// dirty great red error message</font><a name="a539"></a><br />539           <strong><font color="#008000">$strMsg</font></strong> .=<a name="a540"></a><br />540               <font color="#ff702b">&quot;&lt;div style=\&quot;font-weight: bold; background: red; color: yellow; padding: 10px;\&quot;&gt;&quot;</font><a name="a541"></a><br />541               .<strong><font color="#008000">$arrSabErrData</font></strong><strong>[</strong><font color="#ff702b">&quot;msg&quot;</font><strong>]</strong>.<font color="#ff702b">&quot;&lt;/div&gt;&quot;</font>;<a name="a542"></a><br />542                                           <font color="#a0a0a4">// supplentary Sablotron debug info</font><a name="a543"></a><br />543           <font color="blue">foreach</font><strong>(</strong><strong><font color="#008000">$arrSabErrData</font></strong> AS <strong><font color="#008000">$strSabErrFld</font></strong>=&gt;<strong><font color="#008000">$strSabErrVal</font></strong><strong>)</strong> <strong>{</strong><a name="a544"></a><br />544               <font color="blue">if</font><strong>(</strong><strong><font color="#008000">$strSabErrFld</font></strong> != <font color="#ff702b">&quot;msg&quot;</font><strong>)</strong><a name="a545"></a><br />545               <strong><font color="#008000">$strMsg</font></strong> .= <strong><font color="#008000">$strSabErrFld</font></strong>.<font color="#ff702b">&quot;:&quot;</font>.<strong><font color="#008000">$strSabErrVal</font></strong>.<font color="#ff702b">&quot; &amp;nbsp; &amp;nbsp; &quot;</font>;<a name="a546"></a><br />546           <strong>}</strong><a name="a547"></a><br />547                                           <font color="#a0a0a4">// do a text debug dump if we have a</font><a name="a548"></a><br />548                                           <font color="#a0a0a4">// line number from sablotron. Don't</font><a name="a549"></a><br />549                                           <font color="#a0a0a4">// populate this if the data is not in</font><a name="a550"></a><br />550                                           <font color="#a0a0a4">// the context of the Sablotron error</font><a name="a551"></a><br />551                                           <font color="#a0a0a4">// (avoid confusion).</font><a name="a552"></a><br />552               <font color="blue">if</font><strong>(</strong>isset<strong>(</strong><strong><font color="#008000">$arrSabErrData</font></strong><strong>[</strong><font color="#ff702b">&quot;line&quot;</font><strong>]</strong><strong>)</strong> &amp;&amp; <strong><font color="#008000">$blnHaveTheRightFile</font></strong><strong>)</strong> <strong>{</strong><a name="a553"></a><br />553                   <strong><font color="#008000">$objDebugData</font></strong> =<strong>&amp;</strong> <a name="a554"></a><br />554                       new <a href="../XAO/TextDebugger.html">TextDebugger</a><strong>(</strong><strong><font color="#008000">$xslData</font></strong><strong>,</strong><strong><font color="#008000">$arrSabErrData</font></strong><strong>[</strong><font color="#ff702b">&quot;line&quot;</font><strong>]</strong><strong>)</strong>;<a name="a555"></a><br />555                                           <font color="#a0a0a4">// populate the all-important debug data</font><a name="a556"></a><br />556                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#var$strDebugData">strDebugData</a> =<strong>&amp;</strong> <strong><font color="#008000">$objDebugData</font></strong><strong>-&gt;</strong>strGetHtml<strong>(</strong><strong>)</strong>;<a name="a557"></a><br />557               <strong>}</strong><a name="a558"></a><br />558               elseif<strong>(</strong><a href="http://www.php.net/preg_match">preg_match</a><strong>(</strong><font color="#ff702b">&quot;/XML parser error/i&quot;</font><strong>,</strong><strong><font color="#008000">$arrSabErrData</font></strong><strong>[</strong><font color="#ff702b">&quot;msg&quot;</font><strong>]</strong><strong>)</strong><strong>)</strong> <strong>{</strong><a name="a559"></a><br />559                   <strong><font color="#008000">$objDebugData</font></strong> =<strong>&amp;</strong> <a name="a560"></a><br />560                       new <a href="../XAO/TextDebugger.html">TextDebugger</a><strong>(</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#var$objSrc">objSrc</a><strong>-&gt;</strong>dump_mem<strong>(</strong>true<strong>)</strong><strong>)</strong>;<a name="a561"></a><br />561                                           <font color="#a0a0a4">// populate the all-important debug data</font><a name="a562"></a><br />562                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#var$strDebugData">strDebugData</a> =<strong>&amp;</strong> <strong><font color="#008000">$objDebugData</font></strong><strong>-&gt;</strong>strGetHtml<strong>(</strong><strong>)</strong>;<a name="a563"></a><br />563               <strong>}</strong><a name="a564"></a><br />564               else <strong>{</strong><a name="a565"></a><br />565                   <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#var$strDebugData">strDebugData</a> = <font color="#ff702b">&quot;&lt;div&gt;&lt;b&gt;No debug output available.&lt;/b&gt;&lt;/div&gt;&quot;</font>;<a name="a566"></a><br />566               <strong>}</strong><a name="a567"></a><br />567           <a name="a568"></a><br />568           <strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/Transformer.html#methodThrow">Throw</a><strong>(</strong><strong><font color="#008000">$strMsg</font></strong><strong>,</strong><strong><font color="#008000">$this</font></strong><strong>-&gt;</strong><a href="../XAO/XaoRoot.html#methodarrSetErrFnc">arrSetErrFnc</a><strong>(</strong>__FUNCTION__<strong>,</strong>__LINE__<strong>)</strong><strong>)</strong>;<a name="a569"></a><br />569       <strong>}</strong><a name="a570"></a><br />570   <a name="a571"></a><br />571   <strong>}</strong><a name="a572"></a><br />572   <strong>?&gt;</strong></pre>
</div>
        <div class="credit">
		    <hr class="separator" />
		    Documentation generated on Fri,  3 Oct 2003 19:09:50 +1000 by <a href="http://www.phpdoc.org">phpDocumentor 1.2.2</a>
	      </div>
      </td></tr></table>
    </td>
  </tr>
</table>

</body>
</html>